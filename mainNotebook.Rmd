---
title: "R Notebook"
output: html_notebook
---

t

```{r}
supp<-function(X,values)
{
  count<-0
  n<-0
  flag=0
  if(is.null(dim(X)[1]))
  {
    n<-length(X)
    flag=1
  }
  else
    n<-dim(X)[1]
  for(i in seq(n))
  {
    if(flag==1)
      row<-X[i]
    else
      row<-X[i,]
    if(sum(row==values) == length(values))
      count=count+1
  }
  return(count/n)
}
x <- rbinom(n=10, size=1, prob=0.2)
ny<-rbinom(n=10, size=1, prob=0.05)
y <- x |  ny
supp(X=cbind(x,y),values=c(1,1) )

```
#Sorting
```{r}

bin2dec<-function(x)
{
  newx<-0
  d<-length(x)
  for(i in seq(d))
  {
    newx <- newx+x[i]*2^(d-i)
  }
  return(newx)
}
VecAlignment<-function(mat)
{
  # mat must have the dimension n by d where n and d must be greater than 1.
  newMat<-list()
  d<-dim(mat)[1]
  for(i in seq(d))
  {
    newMat[[sprintf("%d",bin2dec(mat[i,]))]]$name<-mat[i,]
    if(is.null(newMat[[sprintf("%d",bin2dec(mat[i,]))]]$count)==TRUE )
      newMat[[sprintf("%d",bin2dec(mat[i,]))]]$count<-1
    else
      newMat[[sprintf("%d",bin2dec(mat[i,]))]]$count<-newMat[[sprintf("%d",bin2dec(mat[i,]))]]$count+1
  }
  return(newMat)
}

n<-500
d<-10
mat<-matrix(nrow=n,ncol=d)

for(i in seq(n))
{
  mat[i,] <- rbinom(n=d, size=1, prob=0.5)
}
mat[,1]<-mat[,2] | mat[,3]
mat[,4] <- mat[,2] | mat[,5]

D<-VecAlignment(mat)
```

#CondProb

```{r}
#z[c(1,2)]<-1
#y[c(1,2)]<-c(1,0)
# CondProb<-function(D,y,z)
# {
#   p<-0
#   filter<-z != -1
#   if(sum(filter) == 0)
#     nD<-D
#   else
#   {
#     nD<-list()
#     for(i in seq(length(D)) )
#     {
#       flag<-sum(D[[i]]$name[filter] == z[filter])
#       if(flag == sum(filter))
#       {
#         nD[[names(D)[i] ]] <- D[[i]]
#       }
#     }
#   }
#   filterY<- y!= -1
#   count<-0
#   countTotal<-0
#   for(i in seq(length(nD)) )
#   {
#     flag<-sum(nD[[i]]$name[filterY] == y[filterY])
#     countTotal<-countTotal+nD[[i]]$count
#     if(flag == sum(filterY))
#     {
#       count<-count+nD[[i]]$count
#     }
#   }
#   
#   return(list("condP"=count/countTotal, nD=nD,countTotal=countTotal,count=count ))
# }
z<-numeric(d)-1
y<-numeric(d)-1
i=5
j=1
D<-VecAlignment(mat)
y[j]<-c(1)
z[i]<-c(1)
a1<-CondProb(D,y=y,z=z)$condP
b1<-CondProb(D,y=z,z=y)$condP

a1-b1

bIndpTest(mat,i,j)
causalDirTest(mat,i=i,j=j,vi=1,ths=0.25)

```


#independent func
```{r}
#TODO add given z
indpFunc<-function(D,i,j,z=c())
{
  if(is.null(z))
    z<-numeric(d)-1
  
  res<-CondProb(D,y=numeric(d)-1,z=z)
  D<-res$nD
  n<-res$countTotal
  L<-length(D)
  
  indMagitude<-0
  
  z1<-numeric(d)-1

  for(i1 in c(0,1) )
    for(j1 in c(0,1))
    {
        y1<-numeric(d) -1
        y1[c(i,j)] <- c(i1,j1)
        y2<-numeric(d) -1
        y2[c(i)] <- i1
        y3<-numeric(d) -1
        y3[c(j)] <- j1
        
        res2<-CondProb(D,y1,z1)
        n2<-res2$count
        condPair<-res2$condP
        condi<-CondProb(D,y2,z1)$condP
        condj<-CondProb(D,y3,z1)$condP
        indMagitude<-indMagitude+ (abs(condPair - condi*condj)*(n2/n) )
    }
  
  return(indMagitude)
}
z<-numeric(d)-1
z[c(4,5)] = 1
indpFunc(D,1,3,z=z)
```
Indp Bootstrap
```{r}
bIndpTest<-function(mat,i,j,z=c(),alpha=0.05,ths = 0.05,nboot=100)
{
  if(is.null(z))
    z<-numeric(d)-1
  #z[2]<- -1
  
  n<-dim(mat)[1]
  bDx<-matrix(0,nboot,n)
  bIndpDist<-numeric(nboot)
  for(k in seq(nboot))
  {
    bDx[k,]<-sample(1:n,length(1:n),replace = TRUE)
    nMat<-mat[bDx[k,],]
    D<-VecAlignment(nMat)
    bIndpDist[k]<-indpFunc(D,i,j,z=z)
  }
  testRes<-wilcox.test(x=bIndpDist, mu = ths, alternative = "greater")
  confInv<-quantile(bIndpDist, c(0+alpha/2, 1-alpha/2))
  bmean <- mean(bIndpDist)
  return(list(testRes=testRes,confInv=confInv,bmean=bmean))
}
```
# run
```{r}
library(BiCausality)

n<-500
d<-10
mat<-matrix(nrow=n,ncol=d)

for(i in seq(n))
{
  mat[i,] <- rbinom(n=d, size=1, prob=0.5)
}
mat[,1]<-mat[,2] | mat[,3]
mat[,4] <- !mat[,2] | mat[,5]


i=2
j=1
print(sprintf("i%d,j%d",i,j))
bIndpTest(mat,i,j)
i=2
j=4
print(sprintf("i%d,j%d",i,j))
bIndpTest(mat,i,j)
i=2
j=3
print(sprintf("i%d,j%d",i,j))
bIndpTest(mat,i,j)
i=4
j=1
print(sprintf("i%d,j%d",i,j))
bIndpTest(mat,i,j)
i=4
j=1
z<-numeric(d)-1
z[2]<-1
print(sprintf("i%d,j%d",i,j))
bIndpTest(mat,i,j,z=z)

i=2
j=3
z<-numeric(d)-1
z[1]<-0
print(sprintf("i%d,j%d",i,j))
bIndpTest(mat,i,j,z=z)
```
#oddRatio
```{r}
library(BiCausality)
n<-500
d<-10
mat<-matrix(nrow=n,ncol=d)

for(i in seq(n))
{
  mat[i,] <- rbinom(n=d, size=1, prob=0.5)
}
mat[,1]<-mat[,2] | mat[,3]
mat[,4] <- !mat[,2] | mat[,5]

z<-numeric(d)-1
y<-numeric(d)-1
i=5
j=4
D<-VecAlignment(mat)
oddRatioFunc(D,i,j)

i=2
j=5
z<-numeric(d)-1
z[5]<- -1
oddDiffFunc(D,i,j,z=z)
```
```{r}
i=2
j=1
z<-numeric(d)-1
z[2]<- -1
print(sprintf("i%d,j%d",i,j))
assocSignTest(mat,i,j,z=z)
```

