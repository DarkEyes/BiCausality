---
title: "EXP Notebook"
output: html_notebook
---

Experiment notebook
```{r}
library(devtools)
devtools::document()
```

load
```{r}
load("TPMAPdata61.rdata")
```
cleansing
```{r}
mat40<-as.data.frame(DataTProv40$P)
for(i in seq(31))
{
 mode(mat40[,i])= "numeric"
  mat40[is.na(mat40[,i]), i] = 0
  print(sprintf("%d",i )  )
  print(unique(mat40[,i]))
}
mat40<-as.matrix(mat40)
```
mining
```{r}
library(BiCausality)
# alpha=0.05
# nboot=100
# IndpThs=0.05
# CausalThs = 0.25
# slack=0.001
# res50<-bSCMDepndentGraphFunc(mat = mat50, pflag=TRUE,IndpThs =0.01)
# print("Removing confounder(s)")
# res50_2<-BiCausality::bSCMdeConfoundingGraphFunc(res50,IndpThs=IndpThs,alpha=alpha)
# print("Inferring causal graph")
# res50_3<-BiCausality::bSCMCausalGraphFunc(res50_2$E1,res50$Dboot ,alpha=alpha,SignThs=IndpThs,CausalThs = CausalThs,slack=slack)

res50final<-BiCausality::CausalGraphInferMainFunc(mat = mat50)
```

```{r}
library(BiCausality)
confNetFunc<-function(mat,IndpThs=0.1)
{
  d<-dim(mat)[2]
  confNet<-matrix(0,nrow=d,ncol=d)
  D<-VecAlignment(mat)
  confValMat<-matrix(0,nrow=d,ncol=d)
  #===
  for(i in seq(d-1))
    for(j in seq(i+1,d))
    {
      z<-numeric(d)-1
      y<-numeric(d)-1
      y[j]<-c(1)
      z[i]<-c(1)
      a1<-CondProb(D,y=y,z=z)$condP # conf(y|z)
      b1<-CondProb(D,y=z,z=y)$condP # conf(z|y) 
      confValMat[i,j]<-a1
      confValMat[j,i]<-b1
      if((a1-b1)>0 && a1>=IndpThs)
        confNet[i,j]<-1
      else if((b1-a1)>0 && b1>= IndpThs)
        confNet[j,i]<-1
      else
        confNet[i,j]<-0
    }
  return(list(confNet=confNet,confValMat=confValMat) )
}

n<-500
d<-10
mat<-matrix(nrow=n,ncol=d)
for(i in seq(n))
{
  mat[i,] <- rbinom(n=d, size=1, prob=0.5)
}
mat[,1]<-mat[,2] | mat[,3] 
mat[,4] <-mat[,2] | mat[,5]
mat[,6] <- mat[,1] | mat[,4]
res<-confNetFunc(mat=mat,IndpThs=0.9)
res$confNet
res$confValMat

resC<-BiCausality::CausalGraphInferMainFunc(mat = mat,CausalThs=0.1)
resC$CausalGRes$Ehat
```

